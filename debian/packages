# $Id: /trunk/debian/dists/phpmyadmin/debian/packages 256 2005-09-16T14:28:00.091592Z dexter  $

# If the debian/rules or debian/control file is missing, rebuild the file:
#
#   $ yada rebuild control
#   $ yada rebuild rules


Source: phpmyadmin
Section: web
Priority: extra
Maintainer: Piotr Roszatycki <dexter@debian.org>
Standards-Version: 3.6.2
Upstream-Source: <USCAN:http://sf.net/phpmyadmin/phpMyAdmin-([0-9.]*)\.tar\.gz>
Home-Page: <URL:http://www.phpmyadmin.net/>
Description: set of PHP-scripts to administrate MySQL over the WWW
Copyright: GPL
     Copyright (C) 1998-2000 Tobias Ratschiller <tobias_at_ratschiller.com>
     Copyright (C) 2001-2005 Marc Delisle <DelislMa_at_CollegeSherbrooke.qc.ca>
                             Olivier Müller <om_at_omnis.ch>
                             Robin Johnson <robbat2_at_users.sourceforge.net>
                             Alexander M. Turek <me_at_derrabus.de>
                             Michal Cihar <michal_at_cihar.com>
                             Garvin Hicking <me_at_supergarv.de>
                             Michael Keck <mkkeck_at_users.sourceforge.net>
                             [check Documentation.txt/.html file for more details]

Package: phpmyadmin
Architecture: all
Depends: php4 | php4-cgi | php5 | php5-cgi
Depends: php4-mysql | php5-mysql | php5-mysqli
Depends: apache2 | httpd
Depends: []
Recommends: php4-mcrypt | php5-mcrypt
Suggests: mysql-server (>= 3.23.36)
Suggests: php4-gd | php5-gd
Suggests: []
Description: set of PHP-scripts to administrate MySQL over the WWW
 phpMyAdmin is intended to handle the administration of MySQL over the WWW.
 Currently it can:
  - create and drop databases
  - create, copy, drop and alter tables
  - delete, edit and add fields
  - execute any SQL-statement, even batch-queries
  - manage keys on fields
  - load text files into tables
  - create and read dumps of tables
  - export and import CSV data
  - administer one single database as well as a whole database server
  - communicate in 50 different languages
Install: sh
 yada install -data -into /usr/share/phpmyadmin *.php *.css
 yada copy -data -into /usr/share/phpmyadmin css lang libraries themes
 yada remove -data -into /usr/share/phpmyadmin/lang *.sh
 yada remove -data -into /usr/share/phpmyadmin/libraries/fpdf README
 yada remove -data -into /usr/share/phpmyadmin/libraries/transformations *.sh README TEMPLATE*
 yada install -data -into /usr/share/phpmyadmin Documentation.html translators.html
 yada install -data -into /usr/share/phpmyadmin ChangeLog INSTALL README
 yada install -dir /etc/phpmyadmin
 yada install -conf -ucf -subdir phpmyadmin debian/conf/config.inc.php
 yada install -conf -ucf -subdir phpmyadmin debian/conf/config.header.inc.php
 yada install -conf -ucf -subdir phpmyadmin debian/conf/config.footer.inc.php
 yada install -conf -ucf -subdir phpmyadmin debian/conf/htaccess
 yada install -conf -ucf -subdir phpmyadmin debian/conf/apache.conf
 yada symlink -into /usr/share/phpmyadmin -as .htaccess /etc/phpmyadmin/htaccess
 yada symlink -into /var/www /usr/share/phpmyadmin
 yada remove -into /usr/share/phpmyadmin config.default.php
 yada install -into /usr/share/phpmyadmin debian/src/config.inc.php
 yada install -into /usr/share/phpmyadmin debian/src/config.header.inc.php
 yada install -into /usr/share/phpmyadmin debian/src/config.footer.inc.php
 .
 version=$(grep "define.'PMA_VERSION" libraries/defines.lib.php | sed "s/.*, '//; s/'.*//")-Debian-${VERSION##*-}
 sed -e 's/@VERSION@/'"$version"'/' \
     $ROOT/usr/share/phpmyadmin/config.inc.php > $ROOT/usr/share/phpmyadmin/config.inc.php.tmp
 mv -f $ROOT/usr/share/phpmyadmin/config.inc.php.tmp $ROOT/usr/share/phpmyadmin/config.inc.php
 .
 yada install -doc -subdir examples -gzip config.default.php
 yada install -doc README TODO CREDITS
 yada install -doc Documentation.html translators.html
 yada install -doc -as changelog ChangeLog
 yada install -doc -as README.Debian debian/README
 yada install -doc -as NEWS.Debian -gzip debian/NEWS
 yada install -doc -as NEWS debian/NEWS.upstream
 yada install -doc -subdir scripts scripts/*
Templates:
 Template: phpmyadmin/reconfigure-webserver
 Type: multiselect
 Choices: apache, apache-ssl, apache-perl, apache2
 Default:
 _Description: Which web server would you like to reconfigure automatically?
  phpMyAdmin supports any web server that PHP does, but this automatic
  configuration process only supports Apache.
 .
 Template: phpmyadmin/restart-webserver
 Type: boolean
 Default: false
 _Description: Do you want me to restart ${webserver} now?
  Remember that in order to activate the new configuration
  ${webserver} has to be restarted. You can also restart ${webserver}
  manually executing /etc/init.d/${webserver} restart
Config: bash
 db_input medium phpmyadmin/reconfigure-webserver || true
 db_go
Preinst: bash
 if [ "$1" = "upgrade" -a -n "$2" ] && \
   dpkg --compare-versions "$2" lt-nl "2.1.0.1-2"; then
     if [ -d /etc/phpmyadmin ]; then
         for i in config footer header; do
             mv -f /etc/phpmyadmin/$i.inc.php3 /etc/phpmyadmin/$i.inc.php || true
         done
     fi
 fi
 if [ "$1" = "upgrade" -a -n "$2" ] && \
   dpkg --compare-versions "$2" lt-nl "2.5.4-1"; then
     for webserver in apache apache-perl apache-ssl; do
         if grep -qs "^Include /etc/phpmyadmin/apache.conf" /etc/$webserver/httpd.conf; then
             cp -af /etc/$webserver/httpd.conf /etc/$webserver/httpd.conf.old.phpmyadmin
             grep -v "^Include /etc/phpmyadmin/apache.conf" /etc/$webserver/httpd.conf \
                 > /etc/$webserver/httpd.conf.new.phpmyadmin
             chmod --reference=/etc/$webserver/httpd.conf /etc/$webserver/httpd.conf.new.phpmyadmin
             chown --reference=/etc/$webserver/httpd.conf /etc/$webserver/httpd.conf.new.phpmyadmin
             mv -f /etc/$webserver/httpd.conf.new.phpmyadmin /etc/$webserver/httpd.conf
         fi
     done
 fi
 if [ "$1" = "upgrade" -a -n "$2" ] && \
   dpkg --compare-versions "$2" lt-nl "2.5.6-rc2-1"; then
     if [ -d /etc/phpmyadmin ]; then
         for i in footer header; do
             mv -f /etc/phpmyadmin/$i.inc.php /etc/phpmyadmin/$i.inc.php.dpkg-old || true
             ucf --purge /etc/phpmyadmin/$i.inc.php
         done
     fi
 fi
 if [ "$1" = "upgrade" -a -n "$2" ] && \
   dpkg --compare-versions "$2" lt-nl "2:2.6.1-rc2-1"; then
     for webserver in apache apache-perl apache-ssl apache2; do
         if [ -h /etc/$webserver/conf.d/phpmyadmin ]; then
             mv /etc/$webserver/conf.d/phpmyadmin /etc/$webserver/conf.d/phpmyadmin.conf
         fi
     done
 fi
 if [ "$1" = "upgrade" -a -n "$2" ] && \
   dpkg --compare-versions "$2" lt-nl "3:2.6.1-pl2-2"; then
     for webserver in apache apache-perl apache-ssl apache2; do
         if [ -h /etc/$webserver/conf.d/phpmyadmin ] && [ -h /etc/$webserver/conf.d/phpmyadmin.conf ]; then
             rm -f /etc/$webserver/conf.d/phpmyadmin
         fi
     done
 fi
 if [ "$1" = "upgrade" -a -n "$2" ] && \
   dpkg --compare-versions "$2" lt-nl "3:2.6.2-rc1-2"; then
     for webserver in apache apache-perl apache-ssl apache2; do
         if [ -h /etc/$webserver/conf.d/phpmyadmin.conf ]; then
             cat /etc/$webserver/conf.d/phpmyadmin.conf > /etc/$webserver/conf.d/phpmyadmin.conf.dpkg-tmp
             rm -f /etc/$webserver/conf.d/phpmyadmin.conf
             cp /etc/$webserver/conf.d/phpmyadmin.conf.dpkg-tmp /etc/$webserver/conf.d/phpmyadmin.conf
         fi
     done
     mv -f /etc/phpmyadmin/apache.conf /etc/phpmyadmin/apache.conf.dpkg-old || true
     ucf --purge /etc/phpmyadmin/apache.conf
     rm -f /etc/phpmyadmin/apache.conf.md5sum
 fi
 # Trying to fix the mess. Sorry :( See #307275.
 if [ "$1" = "upgrade" -a "$2" = "4:2.6.2-1" ]; then
     if grep -qs "^# Include /etc/apache2/conf\.d/\[^\.#\]\*$" /etc/apache2/apache2.conf; then
         cp -af /etc/apache2/apache2.conf /etc/apache2/apache2.conf.old.phpmyadmin
         grep -v "^Include /etc/apache2/conf\.d/\*\.conf" /etc/apache2/apache2.conf.old.phpmyadmin | \
         sed "s%^# \(Include /etc/apache2/conf\.d/\[^\.#\]\*\)$%\1%" > /etc/apache2/apache2.conf.new.phpmyadmin
         chmod --reference=/etc/apache2/apache2.conf /etc/apache2/apache2.conf.new.phpmyadmin
         chown --reference=/etc/apache2/apache2.conf /etc/apache2/apache2.conf.new.phpmyadmin
         mv -f /etc/apache2/apache2.conf.new.phpmyadmin /etc/apache2/apache2.conf
     fi
 fi
 if [ "$1" = "upgrade" -a -n "$2" ] && \
   dpkg --compare-versions "$2" lt-nl "4:2.6.4-pl1-1"; then
     for webserver in apache apache-perl apache-ssl apache2; do
         if echo "869f29f7cae89228518a87b0758e6bd4  /etc/$webserver/conf.d/phpmyadmin.conf" | md5sum -c >/dev/null 2>&1; then
             rm -f /etc/$webserver/conf.d/phpmyadmin.conf
         fi
     done
     ucf --purge /etc/$webserver/conf.d/phpmyadmin.conf
 fi
 .
 if [ -f /etc/phpmyadmin/apache.conf ]; then
     md5sum /etc/phpmyadmin/apache.conf 2>/dev/null >/etc/phpmyadmin/apache.conf.dpkg-md5sum || true
 fi
Postinst: bash
 if [ "$1" = "configure" -a -f /etc/phpmyadmin/blowfish_secret.inc.php ] \
   && dpkg --compare-versions "$2" lt-nl "1:2.5.7-pl1-2"; then
     chgrp www-data /etc/phpmyadmin/blowfish_secret.inc.php
     chmod 640 /etc/phpmyadmin/blowfish_secret.inc.php
 fi
 .
 if [ "$1" = "configure" ]; then
     if [ ! -f /etc/phpmyadmin/blowfish_secret.inc.php ]; then
         touch /etc/phpmyadmin/blowfish_secret.inc.php
         chgrp www-data /etc/phpmyadmin/blowfish_secret.inc.php
         chmod 640 /etc/phpmyadmin/blowfish_secret.inc.php
         printf "<?php\n\$cfg['blowfish_secret'] = '%s';\n?>\n" \
         `perl -le 'print map{("a".."z","A".."Z",0..9)[int(rand(62))]}(1..16)'` \
             >> /etc/phpmyadmin/blowfish_secret.inc.php
     fi
 .
     db_get phpmyadmin/reconfigure-webserver
     webservers="$RET"
     restart=""
 .
     for webserver in $webservers; do
         webserver=${webserver%,}
         test -x /usr/sbin/$webserver || continue
 .
         case "$webserver" in
             apache|apache-perl|apache-ssl)
                 if [ -x /usr/sbin/modules-config ]; then
                     if [ -f /usr/lib/apache/1.3/libphp4.so ]; then
                         if ! grep -qs "^LoadModule php4_module " /etc/$webserver/modules.conf && \
                            ! grep -qs "^LoadModule php5_module " /etc/$webserver/modules.conf; then
                             modules-config $webserver enable mod_php4
                         fi
                     elif [ -f /usr/lib/apache/1.3/mod_php5.so ]; then
                         if ! grep -qs "^LoadModule php4_module " /etc/$webserver/modules.conf && \
                            ! grep -qs "^LoadModule php5_module " /etc/$webserver/modules.conf; then
                             modules-config $webserver enable mod_php5
                         fi
                     else
                         if [ -f /usr/lib/apache/1.3/mod_actions.so ]; then
                             if ! grep -qs "^LoadModule action_module " /etc/$webserver/modules.conf; then
                                 modules-config $webserver enable mod_actions
                             fi
                         fi
                         if [ -f /usr/lib/apache/1.3/mod_cgi.so ]; then
                             if ! grep -qs "^LoadModule cgi_module " /etc/$webserver/modules.conf && \
                                ! grep -qs "^LoadModule fastcgi_module " /etc/$webserver/modules.conf; then
                                 modules-config $webserver enable mod_cgi
                             fi
                         fi
                     fi
                 fi
                 ;;
             apache2)
                 if [ -d /etc/$webserver/mods-enabled ]; then
                     if [ ! -f /etc/$webserver/mods-enabled/actions.load -a ! -h /etc/$webserver/mods-enabled/actions.load ]; then
                         ln -s /etc/$webserver/mods-available/actions.load /etc/$webserver/mods-enabled/actions.load
                     fi
                     if [ -f /etc/apache2/mods-available/php4.load -a -f /usr/lib/apache2/modules/libphp4.so ]; then
                         if [ ! -f /etc/$webserver/mods-enabled/php4.load -a ! -h /etc/$webserver/mods-enabled/php4.load -a \
                              ! -f /etc/$webserver/mods-enabled/php5.load -a ! -h /etc/$webserver/mods-enabled/php5.load -a \
                              ! -f /etc/$webserver/mods-enabled/php5_filter.load -a ! -h /etc/$webserver/mods-enabled/php5_filter.load -a \
                              ! -f /etc/$webserver/mods-enabled/fcgid.load -a ! -h /etc/$webserver/mods-enabled/fcgid.load -a \
                              ! -f /etc/$webserver/mods-enabled/fastcgi.load -a ! -h /etc/$webserver/mods-enabled/fastcgi.load ]; then
                             ln -s /etc/$webserver/mods-available/php4.conf /etc/$webserver/mods-enabled/php4.conf
                             ln -s /etc/$webserver/mods-available/php4.load /etc/$webserver/mods-enabled/php4.load
                         fi
                     elif [ -f /etc/apache2/mods-available/php5.load -a -f /usr/lib/apache2/modules/mod_php5.so ]; then
                         if [ ! -f /etc/$webserver/mods-enabled/php4.load -a ! -h /etc/$webserver/mods-enabled/php4.load -a \
                              ! -f /etc/$webserver/mods-enabled/php5.load -a ! -h /etc/$webserver/mods-enabled/php5.load -a \
                              ! -f /etc/$webserver/mods-enabled/php5_filter.load -a ! -h /etc/$webserver/mods-enabled/php5_filter.load -a \
                              ! -f /etc/$webserver/mods-enabled/fcgid.load -a ! -h /etc/$webserver/mods-enabled/fcgid.load -a \
                              ! -f /etc/$webserver/mods-enabled/fastcgi.load -a ! -h /etc/$webserver/mods-enabled/fastcgi.load ]; then
                             ln -s /etc/$webserver/mods-available/php5.conf /etc/$webserver/mods-enabled/php5.conf
                             ln -s /etc/$webserver/mods-available/php5.load /etc/$webserver/mods-enabled/php5.load
                         fi
                     else
                         if [ ! -f /etc/$webserver/mods-enabled/cgi.load -a ! -h /etc/$webserver/mods-enabled/cgi.load -a \
                              ! -f /etc/$webserver/mods-enabled/fastcgi.load -a ! -h /etc/$webserver/mods-enabled/fastcgi.load -a \
                              ! -f /etc/$webserver/mods-enabled/fcgid.load -a ! -h /etc/$webserver/mods-enabled/fcgid.load ]; then
                             ln -s /etc/$webserver/mods-available/cgi.load /etc/$webserver/mods-enabled/cgi.load
                         fi
                     fi
                 fi
                 ;;
         esac
 .
         case "$webserver" in
             apache|apache-perl|apache-ssl|apache2)
                 newfile=false
                 if [ -d /etc/$webserver/conf.d ] && [ ! -f /etc/$webserver/conf.d/phpmyadmin.conf ] && [ ! -h /etc/$webserver/conf.d/phpmyadmin.conf ]; then
                     ln -s /etc/phpmyadmin/apache.conf /etc/$webserver/conf.d/phpmyadmin.conf
                     newfile=true
                 fi
                 if $newfile = true || ! md5sum -c /etc/phpmyadmin/apache.conf.dpkg-md5sum >/dev/null 2>&1; then
                     db_reset phpmyadmin/restart-webserver || true
                     db_subst phpmyadmin/restart-webserver webserver "$webserver"
                     db_input high phpmyadmin/restart-webserver || true
                     db_go
                     db_get phpmyadmin/restart-webserver
                     if [ "$RET" = "true" ]; then
                         restart="$restart $webserver"
                     fi
                 fi
                 ;;
         esac
     done
 .
     for webserver in $restart; do
         webserver=${webserver%,}
         if [ -x /usr/sbin/invoke-rc.d ]; then
             invoke-rc.d $webserver restart
         else
             /etc/init.d/$webserver restart
         fi
     done
 .
     rm -f /etc/phpmyadmin/apache.conf.dpkg-md5sum
 fi
Prerm: sh
 if [ "$1" = "remove" ] || [ "$1" = "purge" ]; then
     db_get phpmyadmin/reconfigure-webserver
     webservers="$RET"
     restart=""
 .
     for webserver in $webservers; do
         webserver=${webserver%,}
 .
         case "$webserver" in
             apache|apache-perl|apache-ssl|apache2)
                 rm -f /etc/$webserver/conf.d/phpmyadmin.conf
                 test -x /usr/sbin/$webserver || continue
                 db_reset phpmyadmin/restart-webserver
                 db_subst phpmyadmin/restart-webserver webserver "$webserver"
                 db_input phpmyadmin/restart-webserver high || true
                 db_go
                 db_get phpmyadmin/restart-webserver
                 if [ "$RET" = "true" ]; then
                     restart="$restart $webserver"
                 fi
                 ;;
         esac
     done
 .
     for webserver in $restart; do
         webserver=${webserver%,}
         if [ -x /usr/sbin/invoke-rc.d ]; then
             invoke-rc.d $webserver restart
         else
             /etc/init.d/$webserver restart
         fi
     done
 fi
Postrm: bash
 if [ "$1" = "purge" ]; then
     rm -f /etc/phpmyadmin/apache.conf.dpkg-md5sum
     for webserver in apache apache-perl apache-ssl apache2; do
         if [ -h /etc/$webserver/conf.d/phpmyadmin ]; then
             rm -f /etc/$webserver/conf.d/phpmyadmin
         fi
         rm -f /etc/$webserver/*.old.phpmyadmin
     done
     rm -f /etc/phpmyadmin/blowfish_secret.inc.php
 .
     for ext in '~' '%' .bak .dpkg-tmp .dpkg-new .dpkg-old .dpkg-dist; do
         rm -f "/etc/phpmyadmin/footer.inc.php$ext"
         rm -f "/etc/phpmyadmin/header.inc.php$ext"
         rm -f "/etc/phpmyadmin/apache.conf$ext"
         rm -f "/etc/apache/conf.d/phpmyadmin.conf$ext"
         rm -f "/etc/apache-perl/conf.d/phpmyadmin.conf$ext"
         rm -f "/etc/apache-ssl/conf.d/phpmyadmin.conf$ext"
         rm -f "/etc/apache2/conf.d/phpmyadmin.conf$ext"
     done
 .
     rmdir --ignore-fail-on-non-empty /etc/phpmyadmin || true
 fi
Overrides:
 postinst-uses-db-input
